<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WYSIWYG Image Alignment Test</title>
        <link
            href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
            rel="stylesheet"
        />
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background: #f5f5f5;
            }
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .test-editor {
                margin: 20px 0;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            /* Copy the WYSIWYG component image alignment styles */
            .test-editor .ql-editor img {
                max-width: 100%;
                height: auto;
                display: block;
                margin: 0.5rem 0;
            }

            .test-editor .ql-editor .ql-align-center img,
            .test-editor .ql-editor p.ql-align-center img {
                margin-left: auto;
                margin-right: auto;
                display: block;
            }

            .test-editor .ql-editor .ql-align-right img,
            .test-editor .ql-editor p.ql-align-right img {
                margin-left: auto;
                margin-right: 0;
                display: block;
            }

            .test-editor .ql-editor .ql-align-left img,
            .test-editor .ql-editor p.ql-align-left img {
                margin-left: 0;
                margin-right: auto;
                display: block;
            }

            .test-editor .ql-editor .ql-align-justify img,
            .test-editor .ql-editor p.ql-align-justify img {
                margin-left: 0;
                margin-right: auto;
                display: block;
            }

            .instructions {
                background: #e3f2fd;
                padding: 15px;
                border-radius: 4px;
                margin-bottom: 20px;
            }

            .preview {
                margin-top: 20px;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: #fafafa;
            }

            .preview h3 {
                margin-top: 0;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>WYSIWYG Image Alignment Test</h1>

            <div class="instructions">
                <h3>Instruksi Test:</h3>
                <ol>
                    <li>Klik tombol image (üì∑) di toolbar</li>
                    <li>Upload sebuah gambar</li>
                    <li>Setelah gambar terupload, klik gambar untuk memilih</li>
                    <li>
                        Gunakan tombol align (‚¨ÖÔ∏è ‚ÜîÔ∏è ‚û°Ô∏è) untuk mengatur alignment
                        gambar
                    </li>
                    <li>Lihat hasil di preview di bawah</li>
                </ol>
            </div>

            <div class="test-editor" id="editor"></div>

            <button
                onclick="showPreview()"
                style="
                    margin-top: 10px;
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                "
            >
                Show Preview
            </button>

            <div class="preview" id="preview">
                <h3>Preview:</h3>
                <div id="preview-content"></div>
            </div>
        </div>

        <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
        <script>
            const toolbarOptions = [
                [{ header: [2, 3, false] }],
                ["bold", "italic", "underline", "strike"],
                ["blockquote", "code-block"],
                [{ list: "ordered" }, { list: "bullet" }],
                [{ align: [] }],
                ["link", "image", "clean"],
            ];

            const quill = new Quill("#editor", {
                theme: "snow",
                modules: {
                    toolbar: {
                        container: toolbarOptions,
                        handlers: {
                            image: function () {
                                const input = document.createElement("input");
                                input.setAttribute("type", "file");
                                input.setAttribute("accept", "image/*");
                                input.click();

                                input.onchange = () => {
                                    const file = input.files[0];
                                    if (file) {
                                        // Create a data URL for the image
                                        const reader = new FileReader();
                                        reader.onload = (e) => {
                                            const range =
                                                this.quill.getSelection(true);

                                            // Insert the image in a way that supports alignment
                                            if (range.index > 0) {
                                                const prevChar =
                                                    this.quill.getText(
                                                        range.index - 1,
                                                        1
                                                    );
                                                if (prevChar !== "\n") {
                                                    this.quill.insertText(
                                                        range.index,
                                                        "\n"
                                                    );
                                                    range.index += 1;
                                                }
                                            }

                                            // Insert the image
                                            this.quill.insertEmbed(
                                                range.index,
                                                "image",
                                                e.target.result
                                            );

                                            // Add line break after image for better editing experience
                                            this.quill.insertText(
                                                range.index + 1,
                                                "\n"
                                            );

                                            // Set selection to the line with the image for alignment
                                            this.quill.setSelection(
                                                range.index,
                                                0
                                            );
                                        };
                                        reader.readAsDataURL(file);
                                    }
                                };
                            },
                        },
                    },
                },
            });

            function showPreview() {
                const content = quill.root.innerHTML;
                document.getElementById("preview-content").innerHTML = content;
            }

            // Auto-update preview on text change
            quill.on("text-change", function () {
                showPreview();
            });

            // Initial preview
            showPreview();
        </script>
    </body>
</html>
